[{
  "title": "Capsh Shell Invocation - Linux (Enhanced)",
  "id": "db1ac3be-f606-4e3a-89e0-9607cbe6b98a",
  "description": "Detects the use of the \"capsh\" utility to invoke a shell or execute commands.\nEnhanced to detect bypasses involving flag reordering, execution via -c, and login shells.\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Image LIKE '%/capsh' ESCAPE '\\' AND (CommandLine LIKE '% --%' ESCAPE '\\' OR CommandLine LIKE '% --login%' ESCAPE '\\' OR CommandLine LIKE '% --shell=%' ESCAPE '\\' OR CommandLine LIKE '% -c %' ESCAPE '\\' OR CommandLine LIKE '% --shell %' ESCAPE '\\')"
  ],
  "rule_level": "high",
  "tags": [
    "attack.execution",
    "attack.t1059.004",
    "attack.privilege_escalation"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 30,
      "Provider_Name": "Linux-Sysmon",
      "Guid": "{ff032593-a8d3-4f13-b0d6-01fc615a0f97}",
      "EventID": 1,
      "Version": 5,
      "Level": 4,
      "Task": 1,
      "Opcode": 0,
      "Keywords": "0x8000000000000000",
      "SystemTime": "2026-01-16T16:30:53.057550000Z",
      "EventRecordID": 900669,
      "ProcessID": "1624",
      "ThreadID": "1624",
      "Channel": "Linux-Sysmon/Operational",
      "Computer": "vincenzolog-VMware-Virtual-Platform",
      "UserId": "0",
      "RuleName": "-",
      "UtcTime": "2026-01-16 15:32:15.709",
      "ProcessGuid": "{8b8a9dc4-59ff-696a-11a3-767a88590000}",
      "Image": "/usr/sbin/capsh",
      "User": "root",
      "OriginalLogfile": "Capsh_Shell_Invocation_attack87.log-ZCO7ZDXN.json",
      "FileVersion": "-",
      "Description": "-",
      "Product": "-",
      "Company": "-",
      "OriginalFileName": "-",
      "CommandLine": "/usr/sbin/capsh -- -c ls -la /root",
      "CurrentDirectory": "/home/vincenzolog/Auto_test",
      "LogonGuid": "{8b8a9dc4-0000-0000-0000-000005000000}",
      "LogonId": 0,
      "TerminalSessionId": 3,
      "IntegrityLevel": "no level",
      "SHA256": "e5ce3b058185f1379d7280ae5057e3d92bab8619cb08a78b1ed6a11c08d8726c",
      "Hashes": "SHA256=e5ce3b058185f1379d7280ae5057e3d92bab8619cb08a78b1ed6a11c08d8726c",
      "ParentProcessGuid": "{8b8a9dc4-59ff-696a-1dd8-08dfd2600000}",
      "ParentProcessId": 105102,
      "ParentImage": "/usr/bin/dash",
      "ParentCommandLine": "/bin/sh",
      "ParentUser": "root"
    }
  ]
}]