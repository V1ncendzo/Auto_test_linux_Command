[{
  "title": "OMIGOD SCX RunAsProvider ExecuteShellCommand",
  "id": "21541900-27a9-4454-9c4c-3f0a4240344a",
  "description": "Rule to detect the use of the SCX RunAsProvider Invoke_ExecuteShellCommand to execute any UNIX/Linux command using the /bin/sh shell.\nSCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including\nMicrosoft Operations Manager, Microsoft Azure, and Microsoft Operations Management Suite.\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE User='root' AND LogonId=0 AND CurrentDirectory='/var/opt/microsoft/scx/tmp' AND CommandLine LIKE '%/bin/sh%' ESCAPE '\\'"
  ],
  "rule_level": "high",
  "tags": [
    "attack.privilege-escalation",
    "attack.initial-access",
    "attack.execution",
    "attack.t1068",
    "attack.t1190",
    "attack.t1203"
  ],
  "count": 3,
  "matches": [
    {
      "row_id": 17,
      "Provider_Name": "Linux-Sysmon",
      "Guid": "{ff032593-a8d3-4f13-b0d6-01fc615a0f97}",
      "EventID": 1,
      "Version": 5,
      "Level": 4,
      "Task": 1,
      "Opcode": 0,
      "Keywords": "0x8000000000000000",
      "SystemTime": "2026-01-09T15:18:02.718780000Z",
      "EventRecordID": 146541,
      "ProcessID": "8040",
      "ThreadID": "8040",
      "Channel": "Linux-Sysmon/Operational",
      "Computer": "vincenzolog-VMware-Virtual-Platform",
      "UserId": "0",
      "RuleName": "-",
      "UtcTime": "2026-01-09 06:44:03.446",
      "ProcessGuid": "{8b8a9dc4-a3b3-6960-2da3-198e05650000}",
      "Image": "/usr/bin/bash",
      "FileVersion": "-",
      "Description": "-",
      "Product": "-",
      "Company": "-",
      "OriginalFileName": "-",
      "CommandLine": "bash -c a=\"/bin/sh\"; echo $a",
      "CurrentDirectory": "/var/opt/microsoft/scx/tmp",
      "User": "root",
      "LogonGuid": "{8b8a9dc4-0000-0000-0000-000006000000}",
      "LogonId": 0,
      "TerminalSessionId": 3,
      "IntegrityLevel": "no level",
      "SHA256": "bc5945feb8bd26203ebfafea5ce1878bb2e32cb8fb50ab7ae395cfb1e1aaaef1",
      "Hashes": "SHA256=bc5945feb8bd26203ebfafea5ce1878bb2e32cb8fb50ab7ae395cfb1e1aaaef1",
      "ParentProcessGuid": "{8b8a9dc4-a3b3-6960-1de8-5a8e4f5b0000}",
      "ParentProcessId": 49968,
      "ParentImage": "/usr/bin/dash",
      "ParentCommandLine": "/bin/sh",
      "ParentUser": "root",
      "OriginalLogfile": "OMIGOD_SCX_RunAsProvider_ExecuteShellCommand_attack244.log-H9Y646XM.json"
    },
    {
      "row_id": 19,
      "Provider_Name": "Linux-Sysmon",
      "Guid": "{ff032593-a8d3-4f13-b0d6-01fc615a0f97}",
      "EventID": 1,
      "Version": 5,
      "Level": 4,
      "Task": 1,
      "Opcode": 0,
      "Keywords": "0x8000000000000000",
      "SystemTime": "2026-01-09T15:18:02.721550000Z",
      "EventRecordID": 146543,
      "ProcessID": "8040",
      "ThreadID": "8040",
      "Channel": "Linux-Sysmon/Operational",
      "Computer": "vincenzolog-VMware-Virtual-Platform",
      "UserId": "0",
      "RuleName": "-",
      "UtcTime": "2026-01-09 06:44:03.450",
      "ProcessGuid": "{8b8a9dc4-a3b3-6960-d15b-96a93b5e0000}",
      "Image": "/usr/bin/sudo",
      "FileVersion": "-",
      "Description": "-",
      "Product": "-",
      "Company": "-",
      "OriginalFileName": "-",
      "CommandLine": "sudo /bin/sh -c id",
      "CurrentDirectory": "/var/opt/microsoft/scx/tmp",
      "User": "root",
      "LogonGuid": "{8b8a9dc4-0000-0000-0000-000006000000}",
      "LogonId": 0,
      "TerminalSessionId": 3,
      "IntegrityLevel": "no level",
      "SHA256": "654d953098b5dd26fcc3af44d4cf6e986f61f84ad9198d57722702c6034bd686",
      "Hashes": "SHA256=654d953098b5dd26fcc3af44d4cf6e986f61f84ad9198d57722702c6034bd686",
      "ParentProcessGuid": "{8b8a9dc4-a3b3-6960-1de8-5a8e4f5b0000}",
      "ParentProcessId": 49968,
      "ParentImage": "/usr/bin/dash",
      "ParentCommandLine": "/bin/sh",
      "ParentUser": "root",
      "OriginalLogfile": "OMIGOD_SCX_RunAsProvider_ExecuteShellCommand_attack244.log-H9Y646XM.json"
    },
    {
      "row_id": 20,
      "Provider_Name": "Linux-Sysmon",
      "Guid": "{ff032593-a8d3-4f13-b0d6-01fc615a0f97}",
      "EventID": 1,
      "Version": 5,
      "Level": 4,
      "Task": 1,
      "Opcode": 0,
      "Keywords": "0x8000000000000000",
      "SystemTime": "2026-01-09T15:18:02.733628000Z",
      "EventRecordID": 146544,
      "ProcessID": "8040",
      "ThreadID": "8040",
      "Channel": "Linux-Sysmon/Operational",
      "Computer": "vincenzolog-VMware-Virtual-Platform",
      "UserId": "0",
      "RuleName": "-",
      "UtcTime": "2026-01-09 06:44:03.462",
      "ProcessGuid": "{8b8a9dc4-a3b3-6960-1dd8-3c7d41560000}",
      "Image": "/usr/bin/dash",
      "FileVersion": "-",
      "Description": "-",
      "Product": "-",
      "Company": "-",
      "OriginalFileName": "-",
      "CommandLine": "/bin/sh -c id",
      "CurrentDirectory": "/var/opt/microsoft/scx/tmp",
      "User": "root",
      "LogonGuid": "{8b8a9dc4-1c2a-6961-0000-000009000000}",
      "LogonId": 0,
      "TerminalSessionId": 3,
      "IntegrityLevel": "no level",
      "SHA256": "86d31f6fb799e91fa21bad341484564510ca287703a16e9e46c53338776f4f42",
      "Hashes": "SHA256=86d31f6fb799e91fa21bad341484564510ca287703a16e9e46c53338776f4f42",
      "ParentProcessGuid": "{00000000-0000-0000-0000-000000000000}",
      "ParentProcessId": 49974,
      "ParentImage": "-",
      "ParentCommandLine": "-",
      "ParentUser": "-",
      "OriginalLogfile": "OMIGOD_SCX_RunAsProvider_ExecuteShellCommand_attack244.log-H9Y646XM.json"
    }
  ]
},
{
  "title": "Syslog Clearing or Removal Via System Utilities",
  "id": "3fcc9b35-39e4-44c0-a2ad-9e82b6902b31",
  "description": "Detects specific commands commonly used to remove or empty the syslog. Which is a technique often used by attacker as a method to hide their tracks\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE (CommandLine LIKE '%/var/log/syslog%' ESCAPE '\\' AND ((Image LIKE '%/rm' ESCAPE '\\' AND (CommandLine LIKE '% -r %' ESCAPE '\\' OR CommandLine LIKE '% -f %' ESCAPE '\\' OR CommandLine LIKE '% -rf %' ESCAPE '\\' OR CommandLine LIKE '%/var/log/syslog%' ESCAPE '\\')) OR Image LIKE '%/unlink' ESCAPE '\\' OR Image LIKE '%/mv' ESCAPE '\\' OR (Image LIKE '%/truncate' ESCAPE '\\' AND (CommandLine LIKE '%0 %' ESCAPE '\\' AND CommandLine LIKE '%/var/log/syslog%' ESCAPE '\\') AND (CommandLine LIKE '%-s %' ESCAPE '\\' OR CommandLine LIKE '%-c %' ESCAPE '\\' OR CommandLine LIKE '%--size%' ESCAPE '\\')) OR (Image LIKE '%/ln' ESCAPE '\\' AND (CommandLine LIKE '%/dev/null %' ESCAPE '\\' AND CommandLine LIKE '%/var/log/syslog%' ESCAPE '\\') AND (CommandLine LIKE '%-sf %' ESCAPE '\\' OR CommandLine LIKE '%-sfn %' ESCAPE '\\' OR CommandLine LIKE '%-sfT %' ESCAPE '\\')) OR (Image LIKE '%/cp' ESCAPE '\\' AND CommandLine LIKE '%/dev/null%' ESCAPE '\\') OR (Image LIKE '%/shred' ESCAPE '\\' AND CommandLine LIKE '%-u %' ESCAPE '\\'))) OR ((CommandLine LIKE '% > /var/log/syslog%' ESCAPE '\\' OR CommandLine LIKE '% >/var/log/syslog%' ESCAPE '\\' OR CommandLine LIKE '% >| /var/log/syslog%' ESCAPE '\\' OR CommandLine LIKE '%: > /var/log/syslog%' ESCAPE '\\' OR CommandLine LIKE '%:> /var/log/syslog%' ESCAPE '\\' OR CommandLine LIKE '%:>/var/log/syslog%' ESCAPE '\\' OR CommandLine LIKE '%>|/var/log/syslog%' ESCAPE '\\') OR (CommandLine LIKE '%journalctl --vacuum%' ESCAPE '\\' OR CommandLine LIKE '%journalctl --rotate%' ESCAPE '\\'))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.defense-evasion",
    "attack.t1070.002"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 6,
      "Provider_Name": "Linux-Sysmon",
      "Guid": "{ff032593-a8d3-4f13-b0d6-01fc615a0f97}",
      "EventID": 1,
      "Version": 5,
      "Level": 4,
      "Task": 1,
      "Opcode": 0,
      "Keywords": "0x8000000000000000",
      "SystemTime": "2026-01-09T15:18:01.681331000Z",
      "EventRecordID": 146530,
      "ProcessID": "8040",
      "ThreadID": "8040",
      "Channel": "Linux-Sysmon/Operational",
      "Computer": "vincenzolog-VMware-Virtual-Platform",
      "UserId": "0",
      "RuleName": "-",
      "UtcTime": "2026-01-09 06:44:02.410",
      "ProcessGuid": "{8b8a9dc4-a3b2-6960-1d78-1a9666640000}",
      "Image": "/usr/bin/dash",
      "FileVersion": "-",
      "Description": "-",
      "Product": "-",
      "Company": "-",
      "OriginalFileName": "-",
      "CommandLine": "/bin/sh -c journalctl --vacuum-time=1s",
      "CurrentDirectory": "/home/vincenzolog/Auto_test",
      "User": "root",
      "LogonGuid": "{8b8a9dc4-0000-0000-0000-000006000000}",
      "LogonId": 0,
      "TerminalSessionId": 3,
      "IntegrityLevel": "no level",
      "SHA256": "86d31f6fb799e91fa21bad341484564510ca287703a16e9e46c53338776f4f42",
      "Hashes": "SHA256=86d31f6fb799e91fa21bad341484564510ca287703a16e9e46c53338776f4f42",
      "ParentProcessGuid": "{8b8a9dc4-9fa5-6960-1d23-700000000000}",
      "ParentProcessId": 41048,
      "ParentImage": "/usr/bin/python3.12",
      "ParentCommandLine": "python3",
      "ParentUser": "root",
      "OriginalLogfile": "OMIGOD_SCX_RunAsProvider_ExecuteShellCommand_attack244.log-H9Y646XM.json"
    },
    {
      "row_id": 8,
      "Provider_Name": "Linux-Sysmon",
      "Guid": "{ff032593-a8d3-4f13-b0d6-01fc615a0f97}",
      "EventID": 1,
      "Version": 5,
      "Level": 4,
      "Task": 1,
      "Opcode": 0,
      "Keywords": "0x8000000000000000",
      "SystemTime": "2026-01-09T15:18:01.683433000Z",
      "EventRecordID": 146532,
      "ProcessID": "8040",
      "ThreadID": "8040",
      "Channel": "Linux-Sysmon/Operational",
      "Computer": "vincenzolog-VMware-Virtual-Platform",
      "UserId": "0",
      "RuleName": "-",
      "UtcTime": "2026-01-09 06:44:02.412",
      "ProcessGuid": "{8b8a9dc4-a3b2-6960-cd7b-d2390f610000}",
      "Image": "/usr/bin/journalctl",
      "FileVersion": "-",
      "Description": "-",
      "Product": "-",
      "Company": "-",
      "OriginalFileName": "-",
      "CommandLine": "journalctl --vacuum-time=1s",
      "CurrentDirectory": "/home/vincenzolog/Auto_test",
      "User": "root",
      "LogonGuid": "{8b8a9dc4-0000-0000-0000-000006000000}",
      "LogonId": 0,
      "TerminalSessionId": 3,
      "IntegrityLevel": "no level",
      "SHA256": "7bd10a9c601c3204a6c464fc517b204e469eca7f12b09f9c4826f3cc1e42bd79",
      "Hashes": "SHA256=7bd10a9c601c3204a6c464fc517b204e469eca7f12b09f9c4826f3cc1e42bd79",
      "ParentProcessGuid": "{8b8a9dc4-a3b2-6960-1d78-1a9666640000}",
      "ParentProcessId": 49965,
      "ParentImage": "/usr/bin/dash",
      "ParentCommandLine": "/bin/sh",
      "ParentUser": "root",
      "OriginalLogfile": "OMIGOD_SCX_RunAsProvider_ExecuteShellCommand_attack244.log-H9Y646XM.json"
    }
  ]
},
{
  "title": "Local System Accounts Discovery - Linux",
  "id": "b45e3d6f-42c6-47d8-a478-df6bd6cf534c",
  "description": "Detects enumeration of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Image LIKE '%/lastlog' ESCAPE '\\' OR CommandLine LIKE '%''x:0:''%' ESCAPE '\\' OR ((Image LIKE '%/cat' ESCAPE '\\' OR Image LIKE '%/ed' ESCAPE '\\' OR Image LIKE '%/head' ESCAPE '\\' OR Image LIKE '%/more' ESCAPE '\\' OR Image LIKE '%/nano' ESCAPE '\\' OR Image LIKE '%/tail' ESCAPE '\\' OR Image LIKE '%/vi' ESCAPE '\\' OR Image LIKE '%/vim' ESCAPE '\\' OR Image LIKE '%/less' ESCAPE '\\' OR Image LIKE '%/emacs' ESCAPE '\\' OR Image LIKE '%/sqlite3' ESCAPE '\\' OR Image LIKE '%/makemap' ESCAPE '\\') AND (CommandLine LIKE '%/etc/passwd%' ESCAPE '\\' OR CommandLine LIKE '%/etc/shadow%' ESCAPE '\\' OR CommandLine LIKE '%/etc/sudoers%' ESCAPE '\\' OR CommandLine LIKE '%/etc/spwd.db%' ESCAPE '\\' OR CommandLine LIKE '%/etc/pwd.db%' ESCAPE '\\' OR CommandLine LIKE '%/etc/master.passwd%' ESCAPE '\\')) OR Image LIKE '%/id' ESCAPE '\\' OR (Image LIKE '%/lsof' ESCAPE '\\' AND CommandLine LIKE '%-u%' ESCAPE '\\')"
  ],
  "rule_level": "low",
  "tags": [
    "attack.discovery",
    "attack.t1087.001"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 21,
      "Provider_Name": "Linux-Sysmon",
      "Guid": "{ff032593-a8d3-4f13-b0d6-01fc615a0f97}",
      "EventID": 1,
      "Version": 5,
      "Level": 4,
      "Task": 1,
      "Opcode": 0,
      "Keywords": "0x8000000000000000",
      "SystemTime": "2026-01-09T15:18:02.735172000Z",
      "EventRecordID": 146545,
      "ProcessID": "8040",
      "ThreadID": "8040",
      "Channel": "Linux-Sysmon/Operational",
      "Computer": "vincenzolog-VMware-Virtual-Platform",
      "UserId": "0",
      "RuleName": "-",
      "UtcTime": "2026-01-09 06:44:03.464",
      "ProcessGuid": "{8b8a9dc4-a3b3-6960-017f-3e8583620000}",
      "Image": "/usr/bin/id",
      "FileVersion": "-",
      "Description": "-",
      "Product": "-",
      "Company": "-",
      "OriginalFileName": "-",
      "CommandLine": "id",
      "CurrentDirectory": "/var/opt/microsoft/scx/tmp",
      "User": "root",
      "LogonGuid": "{8b8a9dc4-1c2a-6961-0000-000009000000}",
      "LogonId": 0,
      "TerminalSessionId": 3,
      "IntegrityLevel": "no level",
      "SHA256": "5a5817d18b918a366ef4c07e2806e0aeb3d9b144ff90c036f0a4a94f347a96fc",
      "Hashes": "SHA256=5a5817d18b918a366ef4c07e2806e0aeb3d9b144ff90c036f0a4a94f347a96fc",
      "ParentProcessGuid": "{8b8a9dc4-a3b3-6960-1dd8-3c7d41560000}",
      "ParentProcessId": 49975,
      "ParentImage": "/usr/bin/dash",
      "ParentCommandLine": "/bin/sh",
      "ParentUser": "root",
      "OriginalLogfile": "OMIGOD_SCX_RunAsProvider_ExecuteShellCommand_attack244.log-H9Y646XM.json"
    },
    {
      "row_id": 22,
      "Provider_Name": "Linux-Sysmon",
      "Guid": "{ff032593-a8d3-4f13-b0d6-01fc615a0f97}",
      "EventID": 5,
      "Version": 3,
      "Level": 4,
      "Task": 5,
      "Opcode": 0,
      "Keywords": "0x8000000000000000",
      "SystemTime": "2026-01-09T15:18:02.737443000Z",
      "EventRecordID": 146546,
      "ProcessID": "8040",
      "ThreadID": "8040",
      "Channel": "Linux-Sysmon/Operational",
      "Computer": "vincenzolog-VMware-Virtual-Platform",
      "UserId": "0",
      "RuleName": "-",
      "UtcTime": "2026-01-09 06:44:03.467",
      "ProcessGuid": "{8b8a9dc4-a3b3-6960-017f-3e8583620000}",
      "Image": "/usr/bin/id",
      "User": "root",
      "OriginalLogfile": "OMIGOD_SCX_RunAsProvider_ExecuteShellCommand_attack244.log-H9Y646XM.json"
    }
  ]
}]